<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 다른 mapper와 중복되지 않도록 네임스페이스 기재 -->
<mapper namespace="lecture">
	<select id="cartlist" parameterType="String" resultType="com.hankyung.domain.lecture.LectureDTO">
		SELECT * FROM hk_cart
		 WHERE id = #{id}
	</select>
	
	<select id="popularList" resultType="com.hankyung.domain.lecture.LectureDTO">
		<![CDATA[
			SELECT * FROM
				(SELECT * FROM hk_lecture
				ORDER BY rgstrmem DESC)
			WHERE rownum <= 3
		]]>
	</select>
	
	<select id="newList" resultType="com.hankyung.domain.lecture.LectureDTO">
		<![CDATA[
			SELECT * FROM
				(SELECT * FROM hk_lecture
				ORDER BY lno DESC)
			WHERE rownum <= 3
		]]>
	</select>
	
	<select id="countArticle" resultType="int">
		SELECT COUNT(*)
		FROM hk_lecture WHERE
		<choose>
			<when test="search_option != 'all'">
				<if test="search_option == 'title'">
					lname LIKE #{keyword}
				</if>
				<if test="search_option == 'writer'">
					tname LIKE #{keyword}
				</if>
			</when>
			<otherwise>
				lname LIKE #{keyword}
				OR tname LIKE #{keyword}
			</otherwise>
		</choose>
	</select>

	<select id="lectureList" resultType="com.hankyung.domain.lecture.LectureDTO">
		SELECT * FROM
			(SELECT rownum AS rnum, A.* FROM
				( SELECT *
				FROM hk_lecture WHERE
				<choose>
					<when test="search_option != 'all'">
						<if test="search_option == 'title'">
							lname LIKE #{keyword}
						</if>
						<if test="search_option == 'writer'">
							tname LIKE #{keyword}
						</if>
					</when>
					<otherwise>
						lname LIKE #{keyword}
						OR tname LIKE #{keyword}
					</otherwise>
				</choose>
				<if test="sort_option == 'new'">
				ORDER BY lno DESC
				</if>
				<if test="sort_option == 'good'">
				ORDER BY rgstrmem DESC, lno DESC
				</if>
				)
			A)
		WHERE rnum BETWEEN #{start} AND #{end}
	</select>
	
	<select id="view" resultType="com.hankyung.domain.lecture.LectureDTO">
		SELECT * FROM hk_lecture
		WHERE lno = #{lno}
	</select>
	
	<select id="price" resultType="int" >
           SELECT SUM(price)
             FROM hk_cart
            WHERE id = #{id}
     </select>
     
     <select id="goodCheck" parameterType="hashmap" resultType="int">
     	SELECT COUNT(*)
     	FROM lecture_good
     	WHERE lno = #{lno} AND id = #{id}
     </select>
     
     <delete id="goodDelete" parameterType="hashmap">
     	DELETE FROM lecture_good
     	WHERE lno = #{lno} AND id = #{id}
     </delete>
     
     <insert id="goodInsert" parameterType="hashmap">
     	INSERT INTO lecture_good(lno, id)
     	VALUES(#{lno}, #{id})
     </insert>
</mapper>